<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modelo Predictivo ‚Äì Disponibilidad y Confiabilidad de Activos</title>
  <link rel="stylesheet" href="css/styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" crossorigin="anonymous" defer></script>
  <script src="js/app.js" defer></script>
</head>
<body>

<div class="dashboard-wrapper">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ENCABEZADO
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <header class="site-header">
    <div class="header-brand">
      <div class="header-logo">
        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="24" r="22" stroke="#00d4ff" stroke-width="1.5" stroke-dasharray="4 3"/>
          <circle cx="24" cy="24" r="8" fill="none" stroke="#00d4ff" stroke-width="1.8"/>
          <rect x="22" y="2"  width="4" height="7" rx="1" fill="#00d4ff"/>
          <rect x="22" y="39" width="4" height="7" rx="1" fill="#00d4ff"/>
          <rect x="2"  y="22" width="7" height="4" rx="1" fill="#00d4ff"/>
          <rect x="39" y="22" width="7" height="4" rx="1" fill="#00d4ff"/>
          <rect x="8.5"  y="8.5"  width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(45 10.5 8.5)"/>
          <rect x="35.5" y="8.5"  width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(-45 37.5 8.5)"/>
          <rect x="8.5"  y="35.5" width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(-45 10.5 35.5)"/>
          <rect x="35.5" y="35.5" width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(45 37.5 35.5)"/>
          <line x1="24" y1="18" x2="24" y2="30" stroke="#0a0e14" stroke-width="2"/>
          <line x1="18" y1="24" x2="30" y2="24" stroke="#0a0e14" stroke-width="2"/>
        </svg>
      </div>
      <div class="header-text">
        <h1>Modelo Predictivo de Disponibilidad y Confiabilidad</h1>
        <p>Gran Miner√≠a del Cobre ¬∑ Activos Cr√≠ticos ¬∑ Sistema de Monitoreo</p>
      </div>
    </div>
    <div class="header-meta">
      <div class="header-badge">Actualizado: <strong id="last-update">‚Äî</strong></div>
      <button class="btn-ver-db" onclick="abrirModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
        Ver Base de Datos
      </button>
      <div class="live-indicator"><span class="live-dot"></span>En l√≠nea</div>
    </div>
  </header>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       FILTROS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="filters-section">
    <h2>‚ñ∏ Par√°metros de consulta</h2>
    <div class="filters-grid">
      <div class="filter-group">
        <label for="filtro-fecha-desde">Fecha desde</label>
        <input type="date" id="filtro-fecha-desde" />
      </div>
      <div class="filter-group">
        <label for="filtro-fecha-hasta">Fecha hasta</label>
        <input type="date" id="filtro-fecha-hasta" />
      </div>
      <div class="filter-group">
        <label for="filtro-area">√Årea operacional</label>
        <select id="filtro-area"><option value="">Todas las √°reas</option></select>
      </div>
      <div class="filter-group">
        <label for="filtro-tipo">Tipo de activo</label>
        <select id="filtro-tipo"><option value="">Todos los tipos</option></select>
      </div>
      <div class="filters-actions">
        <button class="btn-reset" id="btn-reset">‚Ü∫ Limpiar</button>
      </div>
      <div class="filter-group">
        <label for="filtro-activo">Activo espec√≠fico</label>
        <select id="filtro-activo"><option value="">Todos los activos</option></select>
      </div>
    </div>
    <div class="chips-row">
      <span class="chip" data-filter="7d">√öltimos 7 d√≠as</span>
      <span class="chip" data-filter="30d">√öltimos 30 d√≠as</span>
      <span class="chip" data-filter="top5">Top 5 Cr√≠ticos</span>
    </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       KPIs
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="kpis-grid">
    <div class="kpi-card kpi-disp">
      <div class="kpi-label"><span class="dot"></span>Disponibilidad Promedio</div>
      <div class="kpi-value" id="kpi-disponibilidad">‚Äî</div>
      <div class="kpi-unit">%</div>
      <div class="kpi-sublabel" id="kpi-disp-sub">Cargando datos‚Ä¶</div>
    </div>
    <div class="kpi-card kpi-mtbf">
      <div class="kpi-label"><span class="dot"></span>MTBF Promedio</div>
      <div class="kpi-value" id="kpi-mtbf">‚Äî</div>
      <div class="kpi-unit">horas</div>
      <div class="kpi-sublabel" id="kpi-mtbf-sub">Tiempo entre fallas</div>
    </div>
    <div class="kpi-card kpi-mttr">
      <div class="kpi-label"><span class="dot"></span>MTTR Promedio</div>
      <div class="kpi-value" id="kpi-mttr">‚Äî</div>
      <div class="kpi-unit">horas</div>
      <div class="kpi-sublabel" id="kpi-mttr-sub">Tiempo de reparaci√≥n</div>
    </div>
    <div class="kpi-card kpi-econ">
      <div class="kpi-label"><span class="dot"></span>Impacto Econ√≥mico</div>
      <div class="kpi-value" id="kpi-impacto">‚Äî</div>
      <div class="kpi-unit">USD</div>
      <div class="kpi-sublabel" id="kpi-econ-sub">P√©rdida por indisponibilidad</div>
    </div>
  </section>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       GR√ÅFICOS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <section class="charts-row">
    <div class="chart-panel">
      <div class="chart-header">
        <span class="chart-title">Disponibilidad vs Tiempo</span>
        <span class="chart-badge">% por per√≠odo</span>
      </div>
      <div class="chart-container"><canvas id="chart-disponibilidad"></canvas></div>
    </div>
    <div class="chart-panel">
      <div class="chart-header">
        <span class="chart-title">MTBF vs MTTR por Activo</span>
        <span class="chart-badge">horas</span>
      </div>
      <div class="chart-container"><canvas id="chart-mtbf-mttr"></canvas></div>
    </div>
  </section>

  <div class="chart-panel chart-full">
    <div class="chart-header">
      <span class="chart-title">Ranking de Criticidad por Impacto Econ√≥mico</span>
      <span class="chart-badge">MM USD acumulado</span>
    </div>
    <div class="chart-container"><canvas id="chart-ranking"></canvas></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PANEL RIESGO + SIMULACI√ìN + TABLA
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="bottom-row">
    <aside class="risk-panel">
      <h2 class="section-title">‚ñ∏ Panel de Riesgo ¬∑ Sem√°foro</h2>
      <div class="risk-list" id="risk-list"><div class="empty-state">Cargando activos‚Ä¶</div></div>
      <div class="insight-box" id="insight-text">Analizando datos del per√≠odo seleccionado‚Ä¶</div>
    </aside>

    <div class="right-column">
      <div class="sim-panel">
        <h2 class="section-title">‚ñ∏ Simulaci√≥n de Mejora de Disponibilidad</h2>
        <div class="sim-controls">
          <span class="sim-label">Escenario:</span>
          <button class="sim-btn" data-pct="1">+1%</button>
          <button class="sim-btn" data-pct="2">+2%</button>
          <button class="sim-btn" data-pct="3">+3%</button>
        </div>
        <div class="sim-result" id="sim-result">
          <h3>Seleccione un escenario de mejora</h3>
          <p>Elija +1%, +2% o +3% de disponibilidad para calcular el ahorro potencial estimado en el per√≠odo filtrado.</p>
        </div>
      </div>

      <div class="table-panel">
        <h2 class="section-title">‚ñ∏ Detalle de Registros</h2>
        <div class="table-wrapper">
          <table id="tabla-datos">
            <thead>
              <tr>
                <th>Activo</th><th>√Årea</th><th>Tipo</th><th>Fecha</th>
                <th>Disp. (%)</th><th>MTBF (h)</th><th>MTTR (h)</th>
                <th>H. Falla</th><th>Impacto USD</th>
              </tr>
            </thead>
            <tbody><tr><td colspan="9" class="empty-state">Cargando datos‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       FOOTER DEL DASHBOARD
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <footer class="site-footer">
    <p>Modelo Predictivo de Disponibilidad y Confiabilidad de Activos Cr√≠ticos ¬∑ Gran Miner√≠a del Cobre ¬∑ Datos Simulados ¬∑ Febrero 2026 ¬∑ Creado por Ren√© Jacinto Coayla Causillas</p>
  </footer>

</div><!-- /dashboard-wrapper -->


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL ‚Äì VISOR DE BASE DE DATOS  (estilo Google Sheets / pgAdmin)
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="db-overlay" id="db-overlay" onclick="cerrarModalFuera(event)">
<div class="db-modal" role="dialog" aria-modal="true">

  <!-- App bar (Sheets style) -->
  <div class="db-appbar">
    <div class="db-appbar-left">
      <div class="db-sheets-icon">
        <svg width="20" height="20" viewBox="0 0 32 32"><rect width="32" height="32" rx="3" fill="#0f9d58"/><rect x="7" y="8"  width="18" height="3" rx="1" fill="white" opacity=".9"/><rect x="7" y="14" width="18" height="3" rx="1" fill="white" opacity=".9"/><rect x="7" y="20" width="12" height="3" rx="1" fill="white" opacity=".9"/></svg>
      </div>
      <div class="db-appbar-meta">
        <div class="db-appbar-filename">activos_criticos ‚Äî mindb_prod <span class="db-appbar-saved">‚úì Guardado</span></div>
        <nav class="db-appmenu">
          <span class="db-amitem">Archivo</span>
          <span class="db-amitem">Editar</span>
          <span class="db-amitem">Ver</span>
          <span class="db-amitem db-amitem--active">Datos</span>
          <span class="db-amitem">Herramientas</span>
          <span class="db-amitem">Extensiones</span>
          <span class="db-amitem">Ayuda</span>
        </nav>
      </div>
    </div>
    <div class="db-appbar-right">
      <div class="db-conn-pill">
        <span class="db-conn-dot"></span>
        postgresql://192.168.1.45:5432/activos
      </div>
      <button class="db-share-btn">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
        Compartir
      </button>
      <button class="db-appbar-close" onclick="cerrarModal()" title="Cerrar">‚úï</button>
    </div>
  </div>

  <!-- Toolbar (Sheets style) -->
  <div class="db-toolbar">
    <button class="db-tb" title="Deshacer">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg>
    </button>
    <button class="db-tb" title="Rehacer">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 14 20 9 15 4"/><path d="M4 20v-7a4 4 0 0 1 4-4h12"/></svg>
    </button>
    <button class="db-tb" title="Imprimir">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
    </button>
    <div class="db-tb-div"></div>
    <span class="db-tb-zoom">100% ‚ñæ</span>
    <div class="db-tb-div"></div>
    <button class="db-tb db-tb--run" onclick="ejecutarQuery()" id="btn-run-query">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      Ejecutar (F5)
    </button>
    <div class="db-tb-div"></div>
    <button class="db-tb db-tb--text">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
      Filtrar
    </button>
    <button class="db-tb db-tb--text">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      Ordenar
    </button>
    <div class="db-tb-div"></div>
    <div class="db-tb-searchbox">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#80868b" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input id="db-search" type="text" placeholder="Buscar en resultados‚Ä¶" oninput="filtrarTablaDB()"/>
    </div>
    <div style="flex:1"></div>
    <span class="db-tb-info" id="db-row-count">‚Äî filas</span>
  </div>

  <!-- Barra de f√≥rmula -->
  <div class="db-formulabar">
    <div class="db-fb-cellref">A1</div>
    <div class="db-fb-sep"></div>
    <span class="db-fb-fx">∆í<em>x</em></span>
    <div class="db-fb-query">SELECT * FROM public.activos_criticos WHERE disponibilidad IS NOT NULL ORDER BY impacto_economico DESC</div>
  </div>

  <!-- Cuerpo: Sidebar + √°rea de hoja -->
  <div class="db-body">

    <!-- Sidebar √°rbol -->
    <aside class="db-sidebar">
      <div class="db-sb-title">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
        Explorador de BD
      </div>
      <div class="db-sb-searchrow">
        <input type="text" class="db-sb-search" placeholder="Buscar objeto‚Ä¶"/>
      </div>

      <div class="db-tree">
        <div class="dbt dbt--server dbt--open">
          <svg class="dbt-ico" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="#4285f4" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
          <span class="dbt-lbl">192.168.1.45:5432</span>
          <span class="dbt-tag dbt-tag--blue">PG 15</span>
        </div>
        <div class="dbt dbt--db dbt--open" style="padding-left:20px">
          <svg class="dbt-ico" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#0b8043" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
          <span class="dbt-lbl dbt-lbl--bold">activos</span>
        </div>
        <div class="dbt dbt--open" style="padding-left:36px">
          <svg class="dbt-ico" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#9e9e9e" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
          <span class="dbt-lbl">public</span>
        </div>
        <div class="dbt dbt--open" style="padding-left:50px">
          <svg class="dbt-ico" width="12" height="12" viewBox="0 0 24 24" fill="#fff8e1" stroke="#f9a825" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
          <span class="dbt-lbl">Tablas (4)</span>
        </div>
        <div class="dbt dbt--table dbt--active" style="padding-left:66px">
          <svg class="dbt-ico" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#1a73e8" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="1"/><path d="M3 9h18M3 15h18M9 3v18"/></svg>
          <span class="dbt-lbl dbt-lbl--active">activos_criticos</span>
          <span class="dbt-tag dbt-tag--green" id="db-badge-rows">‚Äî</span>
        </div>
        <div class="dbt dbt--table" style="padding-left:66px">
          <svg class="dbt-ico" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#9e9e9e" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="1"/><path d="M3 9h18M3 15h18M9 3v18"/></svg>
          <span class="dbt-lbl dbt-lbl--dim">planes_mantenimiento</span>
        </div>
        <div class="dbt dbt--table" style="padding-left:66px">
          <svg class="dbt-ico" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#9e9e9e" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="1"/><path d="M3 9h18M3 15h18M9 3v18"/></svg>
          <span class="dbt-lbl dbt-lbl--dim">historial_fallas</span>
        </div>
        <div class="dbt dbt--table" style="padding-left:66px">
          <svg class="dbt-ico" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#9e9e9e" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="1"/><path d="M3 9h18M3 15h18M9 3v18"/></svg>
          <span class="dbt-lbl dbt-lbl--dim">kpis_mensuales</span>
        </div>
        <div class="dbt" style="padding-left:50px;margin-top:3px">
          <svg class="dbt-ico" width="11" height="11" viewBox="0 0 24 24" fill="#e3f2fd" stroke="#1e88e5" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
          <span class="dbt-lbl">Vistas (2)</span>
        </div>
        <div class="dbt" style="padding-left:66px">
          <svg class="dbt-ico" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#1e88e5" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
          <span class="dbt-lbl dbt-lbl--view">v_criticidad_activos</span>
        </div>
        <div class="dbt" style="padding-left:66px">
          <svg class="dbt-ico" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#1e88e5" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
          <span class="dbt-lbl dbt-lbl--view">v_resumen_mensual</span>
        </div>
        <div class="dbt" style="padding-left:50px;margin-top:3px">
          <svg class="dbt-ico" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#9e9e9e" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
          <span class="dbt-lbl">Funciones (5)</span>
        </div>
      </div>
    </aside>

    <!-- √Årea hoja principal -->
    <div class="db-workarea">

      <!-- Editor SQL -->
      <div class="db-sqleditor" id="db-sqleditor">
        <div class="db-sqled-bar">
          <span class="db-sqled-title">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
            consulta_1.sql
          </span>
          <div style="display:flex;gap:6px;align-items:center">
            <button class="db-sqled-run" onclick="ejecutarQuery()">
              <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
              Ejecutar
            </button>
            <button class="db-sqled-collapse" onclick="toggleSQL(this)">‚ñ≤ Colapsar</button>
          </div>
        </div>
        <div class="db-sqled-body" id="db-sqled-body">
          <div class="db-sqled-linenos" id="db-sqled-linenos">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</div>
          <div class="db-sqled-code" contenteditable="true" spellcheck="false"><span class="sk">SELECT</span>
    ac.id,
    ac.fecha,
    ac.area,
    ac.activo,
    ac.tipo_activo,
    ac.disponibilidad,
    ac.mtbf,
    ac.mttr,
    ac.horas_operativas,
    ac.horas_falla,
    ac.costo_hora_indisponibilidad,
    ac.impacto_economico
<span class="sk">FROM</span>  public.activos_criticos ac
<span class="sk">WHERE</span> ac.disponibilidad <span class="so">IS NOT NULL</span>
<span class="sk">ORDER BY</span> ac.impacto_economico <span class="sk">DESC</span><span class="sc">;</span></div>
        </div>
      </div>

      <!-- Resultado: tabs superiores tipo pgAdmin -->
      <div class="db-resultpanel">
        <div class="db-rptabs">
          <button class="db-rptab db-rptab--active" data-sheet="resultado">
            Resultado <span class="db-rptab-badge" id="db-rptab-badge">‚Äî</span>
          </button>
          <button class="db-rptab" data-sheet="ddl">Esquema DDL</button>
          <button class="db-rptab" data-sheet="json">JSON Raw</button>
          <button class="db-rptab" data-sheet="stats">Estad√≠sticas</button>
        </div>

        <!-- Grid resultado (spreadsheet) -->
        <div class="db-rpbody" id="db-rpbody">
          <div class="db-rpcontent db-rpcontent--active" id="rpsheet-resultado">
            <div class="db-grid-scroll">
              <table class="db-spreadsheet" id="db-table">
                <thead id="db-thead"></thead>
                <tbody id="db-tbody"></tbody>
              </table>
            </div>
          </div>

          <div class="db-rpcontent" id="rpsheet-ddl">
            <div class="db-ddl-wrap">
              <div class="db-ddl-bar">
                <span class="db-ddl-crumb">public ‚Üí activos_criticos ‚Üí DDL</span>
                <button class="db-ddl-copy" onclick="this.textContent='‚úì Copiado';setTimeout(()=>this.textContent='Copiar DDL',1800)">Copiar DDL</button>
              </div>
              <pre class="db-ddl-pre"><span class="sc">-- ================================================</span>
<span class="sc">-- Tabla: public.activos_criticos</span>
<span class="sc">-- Base de datos: activos  |  Schema: public</span>
<span class="sc">-- Motor: PostgreSQL 15.3  |  Generado: 2026-02-15</span>
<span class="sc">-- ================================================</span>

<span class="sk">CREATE TABLE IF NOT EXISTS</span> public.activos_criticos (
    id                          <span class="st">SERIAL</span>           <span class="sk">PRIMARY KEY</span>,
    fecha                       <span class="st">DATE</span>             <span class="sk">NOT NULL</span>,
    area                        <span class="st">VARCHAR(20)</span>      <span class="sk">NOT NULL</span>
        <span class="sk">CONSTRAINT</span> chk_area <span class="sk">CHECK</span> (area <span class="sk">IN</span> (<span class="ss">'Mina'</span>, <span class="ss">'Planta'</span>)),
    activo                      <span class="st">VARCHAR(60)</span>      <span class="sk">NOT NULL</span>,
    tipo_activo                 <span class="st">VARCHAR(30)</span>      <span class="sk">NOT NULL</span>,
    disponibilidad              <span class="st">NUMERIC(5,2)</span>     <span class="sk">NOT NULL</span>
        <span class="sk">CONSTRAINT</span> chk_disp <span class="sk">CHECK</span> (disponibilidad <span class="sk">BETWEEN</span> <span class="sn">0</span> <span class="sk">AND</span> <span class="sn">100</span>),
    mtbf                        <span class="st">NUMERIC(8,2)</span>     <span class="sk">NOT NULL</span>,
    mttr                        <span class="st">NUMERIC(6,2)</span>     <span class="sk">NOT NULL</span>,
    horas_operativas            <span class="st">INTEGER</span>          <span class="sk">NOT NULL</span>,
    horas_falla                 <span class="st">INTEGER</span>          <span class="sk">NOT NULL</span>,
    costo_hora_indisponibilidad <span class="st">INTEGER</span>          <span class="sk">NOT NULL</span>,
    impacto_economico           <span class="st">BIGINT</span>           <span class="sk">NOT NULL</span>
        <span class="sk">GENERATED ALWAYS AS</span>
            (horas_falla * costo_hora_indisponibilidad) <span class="sk">STORED</span>
)
<span class="sk">TABLESPACE</span> pg_default;

<span class="sk">ALTER TABLE IF EXISTS</span> public.activos_criticos
    <span class="sk">OWNER TO</span> mindb_admin;

<span class="sc">-- √çndices</span>
<span class="sk">CREATE INDEX</span> idx_act_fecha   <span class="sk">ON</span> public.activos_criticos <span class="sk">USING</span> btree (fecha);
<span class="sk">CREATE INDEX</span> idx_act_area    <span class="sk">ON</span> public.activos_criticos <span class="sk">USING</span> btree (area);
<span class="sk">CREATE INDEX</span> idx_act_activo  <span class="sk">ON</span> public.activos_criticos <span class="sk">USING</span> btree (activo);
<span class="sk">CREATE INDEX</span> idx_act_disp    <span class="sk">ON</span> public.activos_criticos <span class="sk">USING</span> btree (disponibilidad);

<span class="sc">-- Comentarios</span>
<span class="sk">COMMENT ON TABLE</span>  public.activos_criticos
    <span class="sk">IS</span> <span class="ss">'KPIs de confiabilidad y disponibilidad de activos cr√≠ticos. Gran Miner√≠a del Cobre.'</span>;
<span class="sk">COMMENT ON COLUMN</span> public.activos_criticos.disponibilidad
    <span class="sk">IS</span> <span class="ss">'Disponibilidad mec√°nica (%): horas_op / (horas_op + horas_falla) √ó 100'</span>;
<span class="sk">COMMENT ON COLUMN</span> public.activos_criticos.mtbf
    <span class="sk">IS</span> <span class="ss">'Mean Time Between Failures (hrs): tiempo promedio entre fallas consecutivas'</span>;
<span class="sk">COMMENT ON COLUMN</span> public.activos_criticos.mttr
    <span class="sk">IS</span> <span class="ss">'Mean Time To Repair (hrs): tiempo promedio de reparaci√≥n o restauraci√≥n'</span>;</pre>
            </div>
          </div>

          <div class="db-rpcontent" id="rpsheet-json">
            <div class="db-json-bar">
              <span>Mostrando <strong id="json-count">10</strong> registros</span>
              <div class="db-json-btns">
                <button class="db-jbtn db-jbtn--on" onclick="cambiarJsonCount(10,this)">10</button>
                <button class="db-jbtn" onclick="cambiarJsonCount(20,this)">20</button>
                <button class="db-jbtn" onclick="cambiarJsonCount(null,this)">Todos</button>
              </div>
            </div>
            <pre class="db-json-pre" id="db-json-viewer"></pre>
          </div>

          <div class="db-rpcontent" id="rpsheet-stats">
            <div class="db-stats-grid" id="db-stats-grid"></div>
          </div>
        </div><!-- /db-rpbody -->
      </div><!-- /db-resultpanel -->

    </div><!-- /db-workarea -->
  </div><!-- /db-body -->

  <!-- Tabs de hojas (fondo, estilo Google Sheets) -->
  <div class="db-sheettabs">
    <button class="db-sheettab db-sheettab--add" title="Nueva hoja">+</button>
    <button class="db-sheettab db-sheettab--active" onclick="syncSheetTab('resultado',this)">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="1"/><path d="M3 9h18M3 15h18M9 3v18"/></svg>
      activos_criticos
    </button>
    <button class="db-sheettab" onclick="syncSheetTab('ddl',this)">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
      Esquema DDL
    </button>
    <button class="db-sheettab" onclick="syncSheetTab('json',this)">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      JSON Raw
    </button>
    <button class="db-sheettab" onclick="syncSheetTab('stats',this)">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      Estad√≠sticas
    </button>
  </div>

  <!-- Status bar -->
  <div class="db-statusbar">
    <div class="db-sb-left">
      <span class="db-sb-conn"><span class="db-sb-dot"></span>Conectado</span>
      <span class="db-sb-sep">|</span>
      <span id="db-status-text">Listo</span>
      <span class="db-sb-sep">|</span>
      <span id="db-total-registros">‚Äî</span>
    </div>
    <div class="db-sb-right">
      <span id="db-exec-time">‚Äî</span>
      <span class="db-sb-sep">|</span>
      <span class="db-sb-ro">üîí Solo lectura</span>
      <span class="db-sb-sep">|</span>
      <span>PostgreSQL 15.3</span>
      <span class="db-sb-sep">|</span>
      <span>UTF-8</span>
    </div>
  </div>

  <!-- Footer del modal -->
  <div class="db-footer">
    <p>Modelo Predictivo de Disponibilidad y Confiabilidad de Activos Cr√≠ticos ¬∑ Gran Miner√≠a del Cobre ¬∑ Datos Simulados ¬∑ Febrero 2026 ¬∑ Creado por Ren√© Jacinto Coayla Causillas</p>
  </div>

</div><!-- /db-modal -->
</div><!-- /db-overlay -->

</body>
</html>
