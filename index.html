<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modelo Predictivo ‚Äì Disponibilidad y Confiabilidad de Activos</title>
  <link rel="stylesheet" href="css/styles.css" />

  <!-- Chart.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"
          crossorigin="anonymous" defer></script>
  <!-- App JS -->
  <script src="js/app.js" defer></script>
</head>
<body>

<div class="dashboard-wrapper">

  <!-- ============================================================
       ENCABEZADO
       ============================================================ -->
  <header class="site-header">
    <div class="header-brand">
      <div class="header-logo">
        <!-- √çcono SVG inline de engranaje/mina -->
        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="24" r="22" stroke="#00d4ff" stroke-width="1.5" stroke-dasharray="4 3"/>
          <circle cx="24" cy="24" r="8" fill="none" stroke="#00d4ff" stroke-width="1.8"/>
          <!-- Dientes del engranaje -->
          <rect x="22" y="2"  width="4" height="7" rx="1" fill="#00d4ff"/>
          <rect x="22" y="39" width="4" height="7" rx="1" fill="#00d4ff"/>
          <rect x="2"  y="22" width="7" height="4" rx="1" fill="#00d4ff"/>
          <rect x="39" y="22" width="7" height="4" rx="1" fill="#00d4ff"/>
          <rect x="8.5"  y="8.5"  width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(45 10.5 8.5)"/>
          <rect x="35.5" y="8.5"  width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(-45 37.5 8.5)"/>
          <rect x="8.5"  y="35.5" width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(-45 10.5 35.5)"/>
          <rect x="35.5" y="35.5" width="4" height="7" rx="1" fill="#00d4ff" transform="rotate(45 37.5 35.5)"/>
          <!-- Cruz central -->
          <line x1="24" y1="18" x2="24" y2="30" stroke="#0a0e14" stroke-width="2"/>
          <line x1="18" y1="24" x2="30" y2="24" stroke="#0a0e14" stroke-width="2"/>
        </svg>
      </div>
      <div class="header-text">
        <h1>Modelo Predictivo de Disponibilidad y Confiabilidad</h1>
        <p>Gran Miner√≠a del Cobre ¬∑ Activos Cr√≠ticos ¬∑ Sistema de Monitoreo</p>
      </div>
    </div>

    <div class="header-meta">
      <div class="header-badge">
        Actualizado: <strong id="last-update">‚Äî</strong>
      </div>
      <button class="btn-ver-db" id="btn-ver-db" onclick="abrirModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
          <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
        </svg>
        Ver Base de Datos
      </button>
      <div class="live-indicator">
        <span class="live-dot"></span>
        En l√≠nea
      </div>
    </div>
  </header>

  <!-- ============================================================
       MODAL ‚Äì VISOR DE BASE DE DATOS
       ============================================================ -->
  <div class="db-overlay" id="db-overlay" onclick="cerrarModalFuera(event)">
    <div class="db-modal" role="dialog" aria-modal="true" aria-label="Visor de Base de Datos">

      <!-- Barra de t√≠tulo estilo terminal -->
      <div class="db-titlebar">
        <div class="db-titlebar-left">
          <div class="db-traffic-lights">
            <span class="tl tl-red"   onclick="cerrarModal()"></span>
            <span class="tl tl-amber"></span>
            <span class="tl tl-green"></span>
          </div>
          <span class="db-titlebar-title">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
              <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
            </svg>
            confiabilidad_activos.json ‚Äî Solo lectura
          </span>
        </div>
        <div class="db-titlebar-right">
          <span class="db-engine-badge">JSON ¬∑ UTF-8</span>
          <button class="db-close-btn" onclick="cerrarModal()" title="Cerrar">‚úï</button>
        </div>
      </div>

      <!-- Barra de info de la "tabla" -->
      <div class="db-infobar">
        <div class="db-infobar-item">
          <span class="db-info-label">Tabla</span>
          <span class="db-info-value text-cyan">activos_criticos</span>
        </div>
        <div class="db-infobar-item">
          <span class="db-info-label">Registros</span>
          <span class="db-info-value" id="db-total-registros">‚Äî</span>
        </div>
        <div class="db-infobar-item">
          <span class="db-info-label">Columnas</span>
          <span class="db-info-value">11</span>
        </div>
        <div class="db-infobar-item">
          <span class="db-info-label">Fuente</span>
          <span class="db-info-value">data/confiabilidad_activos.json</span>
        </div>
        <div class="db-infobar-item">
          <span class="db-info-label">Tama√±o</span>
          <span class="db-info-value" id="db-file-size">‚Äî</span>
        </div>
        <div class="db-infobar-item">
          <span class="db-info-label">Acceso</span>
          <span class="db-info-value text-green">READ ONLY</span>
        </div>
      </div>

      <!-- Tabs -->
      <div class="db-tabs">
        <button class="db-tab active" data-tab="tabla" onclick="switchTab(this,'tabla')">
          ‚ñ¶ Vista Tabla
        </button>
        <button class="db-tab" data-tab="esquema" onclick="switchTab(this,'esquema')">
          ‚äû Esquema / Columnas
        </button>
        <button class="db-tab" data-tab="json" onclick="switchTab(this,'json')">
          { } Vista JSON
        </button>
        <button class="db-tab" data-tab="stats" onclick="switchTab(this,'stats')">
          ‚àë Estad√≠sticas
        </button>
      </div>

      <!-- Contenido de tabs -->
      <div class="db-content">

        <!-- TAB: Vista Tabla -->
        <div class="db-tab-content active" id="tab-tabla">
          <div class="db-table-toolbar">
            <div class="db-search-wrap">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
              <input type="text" class="db-search" id="db-search" placeholder="Filtrar registros‚Ä¶" oninput="filtrarTablaDB()" />
            </div>
            <span class="db-row-count" id="db-row-count">‚Äî filas</span>
          </div>
          <div class="db-table-wrapper">
            <table class="db-table" id="db-table">
              <thead id="db-thead"></thead>
              <tbody id="db-tbody"></tbody>
            </table>
          </div>
          <div class="db-statusbar">
            <span id="db-status-text">Listo</span>
            <span class="db-readonly-badge">üîí Solo lectura ‚Äî No se permiten modificaciones</span>
          </div>
        </div>

        <!-- TAB: Esquema -->
        <div class="db-tab-content" id="tab-esquema">
          <div class="db-schema-wrap">
            <h3 class="db-schema-title">Definici√≥n de columnas ¬∑ <span class="text-cyan">activos_criticos</span></h3>
            <table class="db-schema-table">
              <thead>
                <tr>
                  <th>#</th><th>Campo</th><th>Tipo</th><th>Rango / Valores</th><th>Descripci√≥n t√©cnica</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>1</td><td class="text-cyan">fecha</td><td class="db-type">STRING</td><td>YYYY-MM-DD</td><td>Fecha de registro del per√≠odo analizado</td></tr>
                <tr><td>2</td><td class="text-cyan">area</td><td class="db-type">ENUM</td><td>"Mina" | "Planta"</td><td>√Årea operacional de origen del activo</td></tr>
                <tr><td>3</td><td class="text-cyan">activo</td><td class="db-type">STRING</td><td>‚Äî</td><td>Nombre identificador del equipo o activo</td></tr>
                <tr><td>4</td><td class="text-cyan">tipo_activo</td><td class="db-type">STRING</td><td>camion, pala, molino, faja, perforadora‚Ä¶</td><td>Categor√≠a t√©cnica del activo</td></tr>
                <tr><td>5</td><td class="text-cyan">disponibilidad</td><td class="db-type">FLOAT</td><td>0.0 ‚Äì 100.0</td><td>Disponibilidad mec√°nica en % del per√≠odo</td></tr>
                <tr><td>6</td><td class="text-cyan">mtbf</td><td class="db-type">FLOAT</td><td>> 0 (horas)</td><td>Mean Time Between Failures ‚Äì horas entre fallas</td></tr>
                <tr><td>7</td><td class="text-cyan">mttr</td><td class="db-type">FLOAT</td><td>> 0 (horas)</td><td>Mean Time To Repair ‚Äì horas promedio de reparaci√≥n</td></tr>
                <tr><td>8</td><td class="text-cyan">horas_operativas</td><td class="db-type">INTEGER</td><td>> 0</td><td>Horas efectivas de operaci√≥n en el per√≠odo</td></tr>
                <tr><td>9</td><td class="text-cyan">horas_falla</td><td class="db-type">INTEGER</td><td>> 0</td><td>Horas de detenci√≥n por falla en el per√≠odo</td></tr>
                <tr><td>10</td><td class="text-cyan">costo_hora_indisponibilidad</td><td class="db-type">INTEGER</td><td>> 0 (USD/h)</td><td>Costo operacional unitario por hora de detenci√≥n</td></tr>
                <tr><td>11</td><td class="text-cyan">impacto_economico</td><td class="db-type">INTEGER</td><td>> 0 (USD)</td><td>P√©rdida estimada = horas_falla √ó costo_hora</td></tr>
              </tbody>
            </table>
            <div class="db-formula-box">
              <span class="db-formula-label">F√≥rmula clave:</span>
              <code>impacto_economico = horas_falla √ó costo_hora_indisponibilidad</code>
            </div>
          </div>
        </div>

        <!-- TAB: Vista JSON -->
        <div class="db-tab-content" id="tab-json">
          <div class="db-json-toolbar">
            <span class="db-json-label">Mostrando primeros <strong id="json-count">10</strong> registros</span>
            <div class="db-json-controls">
              <button class="db-json-btn" onclick="cambiarJsonCount(10)">10</button>
              <button class="db-json-btn" onclick="cambiarJsonCount(20)">20</button>
              <button class="db-json-btn" onclick="cambiarJsonCount(null)">Todos</button>
            </div>
          </div>
          <pre class="db-json-viewer" id="db-json-viewer"></pre>
        </div>

        <!-- TAB: Estad√≠sticas -->
        <div class="db-tab-content" id="tab-stats">
          <div class="db-stats-grid" id="db-stats-grid"></div>
        </div>

      </div><!-- /db-content -->
    </div><!-- /db-modal -->
  </div><!-- /db-overlay -->

  <!-- ============================================================
       FILTROS
       ============================================================ -->
  <section class="filters-section">
    <h2>‚ñ∏ Par√°metros de consulta</h2>

    <div class="filters-grid">

      <div class="filter-group">
        <label for="filtro-fecha-desde">Fecha desde</label>
        <input type="date" id="filtro-fecha-desde" />
      </div>

      <div class="filter-group">
        <label for="filtro-fecha-hasta">Fecha hasta</label>
        <input type="date" id="filtro-fecha-hasta" />
      </div>

      <div class="filter-group">
        <label for="filtro-area">√Årea operacional</label>
        <select id="filtro-area">
          <option value="">Todas las √°reas</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filtro-tipo">Tipo de activo</label>
        <select id="filtro-tipo">
          <option value="">Todos los tipos</option>
        </select>
      </div>

      <div class="filters-actions">
        <button class="btn-reset" id="btn-reset">‚Ü∫ Limpiar</button>
      </div>

      <div class="filter-group">
        <label for="filtro-activo">Activo espec√≠fico</label>
        <select id="filtro-activo">
          <option value="">Todos los activos</option>
        </select>
      </div>

    </div>

    <!-- Chips de filtros r√°pidos -->
    <div class="chips-row">
      <span class="chip" data-filter="7d">√öltimos 7 d√≠as</span>
      <span class="chip" data-filter="30d">√öltimos 30 d√≠as</span>
      <span class="chip" data-filter="top5">Top 5 Cr√≠ticos</span>
    </div>
  </section>

  <!-- ============================================================
       KPIs
       ============================================================ -->
  <section class="kpis-grid" aria-label="Indicadores clave de rendimiento">

    <div class="kpi-card kpi-disp">
      <div class="kpi-label"><span class="dot"></span>Disponibilidad Promedio</div>
      <div class="kpi-value" id="kpi-disponibilidad">‚Äî</div>
      <div class="kpi-unit">%</div>
      <div class="kpi-sublabel" id="kpi-disp-sub">Cargando datos‚Ä¶</div>
    </div>

    <div class="kpi-card kpi-mtbf">
      <div class="kpi-label"><span class="dot"></span>MTBF Promedio</div>
      <div class="kpi-value" id="kpi-mtbf">‚Äî</div>
      <div class="kpi-unit">horas</div>
      <div class="kpi-sublabel" id="kpi-mtbf-sub">Tiempo entre fallas</div>
    </div>

    <div class="kpi-card kpi-mttr">
      <div class="kpi-label"><span class="dot"></span>MTTR Promedio</div>
      <div class="kpi-value" id="kpi-mttr">‚Äî</div>
      <div class="kpi-unit">horas</div>
      <div class="kpi-sublabel" id="kpi-mttr-sub">Tiempo de reparaci√≥n</div>
    </div>

    <div class="kpi-card kpi-econ">
      <div class="kpi-label"><span class="dot"></span>Impacto Econ√≥mico</div>
      <div class="kpi-value" id="kpi-impacto">‚Äî</div>
      <div class="kpi-unit">USD</div>
      <div class="kpi-sublabel" id="kpi-econ-sub">P√©rdida por indisponibilidad</div>
    </div>

  </section>

  <!-- ============================================================
       GR√ÅFICOS PRINCIPALES (2 columnas)
       ============================================================ -->
  <section class="charts-row" aria-label="Gr√°ficos de an√°lisis">

    <div class="chart-panel">
      <div class="chart-header">
        <span class="chart-title">Disponibilidad vs Tiempo</span>
        <span class="chart-badge">% por per√≠odo</span>
      </div>
      <div class="chart-container">
        <canvas id="chart-disponibilidad"></canvas>
      </div>
    </div>

    <div class="chart-panel">
      <div class="chart-header">
        <span class="chart-title">MTBF vs MTTR por Activo</span>
        <span class="chart-badge">horas</span>
      </div>
      <div class="chart-container">
        <canvas id="chart-mtbf-mttr"></canvas>
      </div>
    </div>

  </section>

  <!-- Gr√°fico de ranking (ancho completo) -->
  <div class="chart-panel chart-full">
    <div class="chart-header">
      <span class="chart-title">Ranking de Criticidad por Impacto Econ√≥mico</span>
      <span class="chart-badge">MM USD acumulado</span>
    </div>
    <div class="chart-container">
      <canvas id="chart-ranking"></canvas>
    </div>
  </div>

  <!-- ============================================================
       FILA INFERIOR: Panel de riesgo + Simulaci√≥n + Tabla
       ============================================================ -->
  <div class="bottom-row">

    <!-- Panel de riesgo -->
    <aside class="risk-panel" aria-label="Panel de riesgo">
      <h2 class="section-title">‚ñ∏ Panel de Riesgo ¬∑ Sem√°foro</h2>
      <div class="risk-list" id="risk-list">
        <div class="empty-state">Cargando activos‚Ä¶</div>
      </div>
      <div class="insight-box" id="insight-text">
        Analizando datos del per√≠odo seleccionado‚Ä¶
      </div>
    </aside>

    <!-- Columna derecha: simulaci√≥n + tabla -->
    <div class="right-column">

      <!-- M√≥dulo de simulaci√≥n -->
      <div class="sim-panel">
        <h2 class="section-title">‚ñ∏ Simulaci√≥n de Mejora de Disponibilidad</h2>

        <div class="sim-controls">
          <span class="sim-label">Escenario:</span>
          <button class="sim-btn" data-pct="1">+1%</button>
          <button class="sim-btn" data-pct="2">+2%</button>
          <button class="sim-btn" data-pct="3">+3%</button>
        </div>

        <div class="sim-result" id="sim-result">
          <h3>Seleccione un escenario de mejora</h3>
          <p>Elija +1%, +2% o +3% de disponibilidad para calcular el ahorro potencial estimado en el per√≠odo filtrado.</p>
        </div>
      </div>

      <!-- Tabla de datos -->
      <div class="table-panel">
        <h2 class="section-title">‚ñ∏ Detalle de Registros</h2>
        <div class="table-wrapper">
          <table id="tabla-datos">
            <thead>
              <tr>
                <th>Activo</th>
                <th>√Årea</th>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Disp. (%)</th>
                <th>MTBF (h)</th>
                <th>MTTR (h)</th>
                <th>H. Falla</th>
                <th>Impacto USD</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="9" class="empty-state">Cargando datos‚Ä¶</td></tr>
            </tbody>
          </table>
        </div>
      </div>

    </div><!-- /right-column -->
  </div><!-- /bottom-row -->

</div><!-- /dashboard-wrapper -->

</body>
</html>

